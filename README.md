# Project PLATEAU: 港区ライブ3Dマップ

## 概要

国土交通省の「Project PLATEAU」で提供されている3D都市モデルデータ（港区）を活用し、複数のリアルタイムAPIと連携させたインタラクティブな3Dマップアプリケーションです。Firebaseによるユーザー認証を基盤とし、ログインしたユーザーは気象情報や交通情報と連動した、生きている都市の姿を体験できます。

## 主な機能

* **Firebaseによるユーザー認証**
    * メールアドレス/パスワードおよびGoogleアカウントでのログイン・新規登録機能。

* **レストラン情報の連携（ホットペッパーグルメAPI）**
    * 3Dマップ上の建物をクリックすると、その周辺にある飲食店を検索。
    * 検索結果をポップアップに表示すると同時に、地図上に各店舗の位置をピンでハイライト表示。

* **リアルタイム気象エフェクト（OpenWeatherMap API）**
    * 現在の港区の天気を取得し、画面左上に情報を表示。
    * 天気（晴れ、曇り、雨、雪）に応じて、3D空間の空の色（スカイボックス）や雰囲気が変化。
    * 雨や雪の日には、パーティクルシステムによる降水エフェクトを実装。

* **ライブ交通情報（公共交通オープンデータセンター）**
    * 都営バスのリアルタイム位置情報を取得。
    * 取得した位置情報を元に、3Dマップ上でバスのモデルが走行・位置を更新。

## 技術的なハイライト・工夫した点

当初は画面のフリーズやエラーに直面しましたが、より安定して多機能なアプリケーションにするため、以下の点を重点的に改善・実装しました。

* **非同期処理の導入 (`async`/`await`)**:
    APIからデータを取得する際の待ち時間で画面が固まるのを防ぐため、クリックイベントや各機能の呼び出しを全面的に非同期処理で実装しました。これにより、ユーザー体験を損なうことなく、複数のAPIとスムーズに連携できます。

* **堅牢なエラーハンドリング (`try`/`catch`)**:
    全ての外部API呼び出しを`try...catch`ブロックで囲み、特定の一つのAPI（例：バスAPI）で通信エラーやキーの無効化が発生しても、他の機能（例：天気API）やアプリケーション全体が停止しないように設計しました。エラー発生時にはコンソールにログを残し、安定した動作を継続します。

* **防御的なプログラミング**:
    APIから返されるデータや3Dモデルの属性が常に想定通りとは限らないため、`?.`（オプショナルチェーン）を活用し、データが存在しない場合でもエラーで停止しない、堅牢なコードを記述しました。

* **動的エンティティの管理**:
    地図上にリアルタイムで表示されるバスやレストランのピンを、それぞれ専用の`Map`オブジェクトや配列で管理する仕組みを構築しました。これにより、情報の更新時に古いエンティティを確実に削除し、常に最新の状態を保つクリーンアップ処理を実現しています。

* **機能のモジュール化**:
    天気、交通、レストランといった各APIのロジックをそれぞれ独立した関数や外部ファイル（`weather.js`, `transit.js`）に分割しました。これにより、コードの見通しが良くなり、将来的な機能追加やメンテナンスが容易になっています。

## 使用技術・API

* **フロントエンド**: HTML, CSS, JavaScript, Tailwind CSS
* **ライブラリ**: CesiumJS
* **認証 / バックエンド**: Firebase Authentication
* **ビルドツール**: Vite
* **使用API**:
    * ホットペッパーグルメAPI
    * OpenWeatherMap API
    * 公共交通オープンデータセンターAPI

## 今後の展望

* レストランまでの経路探索APIを導入し、クリック地点から店舗までのルートを3D空間に描画する。
* 国土地理院の古地図APIと連携し、過去の港区にタイムトラベルできる機能を追加する。

## 感想

複数のAPIを連携させることで、単なる3Dモデル表示から、リアルタイム性を備えた「生きている地図」へとアプリケーションを進化させることができ、大きな手応えを感じています。特に、エラーハンドリングや非同期処理の重要性を実践的に学ぶ良い機会となりました。